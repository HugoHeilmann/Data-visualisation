<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisation Interactive - Donn√©es FIFA</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #ecf0f1;
            border-radius: 8px;
        }

        .control-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .control-group label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #34495e;
        }

        select, button {
            padding: 8px 12px;
            border: 1px solid #bdc3c7;
            border-radius: 4px;
            background: white;
            font-size: 14px;
        }

        button {
            background-color: #3498db;
            color: white;
            cursor: pointer;
            border: none;
        }

        button:hover {
            background-color: #2980b9;
        }

        .viz-container {
            display: flex;
            gap: 20px;
        }

        .overview {
            flex: 2;
        }

        .details {
            flex: 1;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
        }

        .scatter-plot {
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .axis {
            font-size: 12px;
        }

        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        .dot {
            stroke: #fff;
            stroke-width: 1.5px;
            cursor: pointer;
        }

        .dot:hover {
            stroke: #000;
            stroke-width: 2px;
        }

        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
            opacity: 0;
        }

        .legend {
            margin-top: 20px;
        }

        .legend-item {
            display: inline-block;
            margin-right: 20px;
            font-size: 12px;
        }

        .legend-color {
            display: inline-block;
            width: 12px;
            height: 12px;
            margin-right: 5px;
            vertical-align: middle;
        }

        .match-info {
            margin-bottom: 15px;
            padding: 10px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #e74c3c;
        }

        .match-info h3 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 14px;
        }

        .stat-label {
            font-weight: bold;
        }

        .highlight {
            stroke: #e74c3c !important;
            stroke-width: 3px !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Analyse Interactive des Matchs FIFA 2022</h1>
        
        <div class="controls">
            <div class="control-group">
                <label>Axe X :</label>
                <select id="x-axis">
                    <option value="possession_team1">Possession √âquipe 1 (%)</option>
                    <option value="attempts_team1">Tentatives √âquipe 1</option>
                    <option value="passes_completed_team1">Passes Compl√©t√©es √âquipe 1</option>
                    <option value="goals_team1">Buts √âquipe 1</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Axe Y :</label>
                <select id="y-axis">
                    <option value="goals_team1">Buts √âquipe 1</option>
                    <option value="on_target_team1">Tirs Cadr√©s √âquipe 1</option>
                    <option value="yellow_cards_team1">Cartons Jaunes √âquipe 1</option>
                    <option value="possession_team1">Possession √âquipe 1 (%)</option>
                </select>
            </div>
            
            <div class="control-group">
                <label>Filtrer par Phase :</label>
                <select id="phase-filter">
                    <option value="all">Toutes les phases</option>
                    <option value="Group A">Groupe A</option>
                    <option value="Group B">Groupe B</option>
                    <option value="Group C">Groupe C</option>
                    <option value="Group D">Groupe D</option>
                    <option value="Group E">Groupe E</option>
                    <option value="Group F">Groupe F</option>
                    <option value="Group G">Groupe G</option>
                    <option value="Group H">Groupe H</option>
                    <option value="Round of 16">8√®mes de finale</option>
                    <option value="Quarter-final">Quarts de finale</option>
                    <option value="Semi-final">Demi-finales</option>
                    <option value="Final">Finale</option>
                </select>
            </div>
            
            <button id="reset-btn">üîÑ Reset Vue</button>
        </div>

        <div class="viz-container">
            <div class="overview">
                <div id="scatter-plot"></div>
                <div class="legend" id="legend"></div>
            </div>
            
            <div class="details">
                <h2>D√©tails du Match</h2>
                <div id="match-details">
                    <p style="color: #7f8c8d; font-style: italic;">
                        Cliquez sur un point pour voir les d√©tails du match
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuration
        const margin = {top: 20, right: 20, bottom: 50, left: 60};
        const width = 700 - margin.left - margin.right;
        const height = 500 - margin.top - margin.bottom;

        // Variables globales
        let allData = [];
        let filteredData = [];
        let currentXAxis = 'possession_team1';
        let currentYAxis = 'goals_team1';

        // Couleurs pour les diff√©rentes phases
        const colorScale = d3.scaleOrdinal()
            .domain(['Group A', 'Group B', 'Group C', 'Group D', 'Group E', 'Group F', 'Group G', 'Group H', 
                     'Round of 16', 'Quarter-final', 'Semi-final', 'Final', 'Play-off for third place'])
            .range(['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c', '#e67e22', '#34495e',
                    '#e91e63', '#ff5722', '#795548', '#ffc107', '#607d8b']);

        // Cr√©ation du SVG principal
        const svg = d3.select("#scatter-plot")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", `translate(${margin.left},${margin.top})`);

        // Tooltip
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip");

        // Chargement des donn√©es
        d3.csv("data/worldcup_dataset.csv").then(rawData => {
            // Transformation des donn√©es
            allData = rawData.map(d => ({
                team1: d.team1,
                team2: d.team2,
                date: new Date(d.date),
                category: d.category,
                goals_team1: +d["number of goals team1"] || 0,
                goals_team2: +d["number of goals team2"] || 0,
                possession_team1: parseFloat(d["possession team1"]) || 0,
                possession_team2: parseFloat(d["possession team2"]) || 0,
                possession_in_contest: parseFloat(d["possession in contest"]) || 0,
                attempts_team1: +d["total attempts team1"] || 0,
                attempts_team2: +d["total attempts team2"] || 0,
                on_target_team1: +d["on target attempts team1"] || 0,
                on_target_team2: +d["on target attempts team2"] || 0,
                passes_team1: +d["passes team1"] || 0,
                passes_team2: +d["passes team2"] || 0,
                passes_completed_team1: +d["passes completed team1"] || 0,
                passes_completed_team2: +d["passes completed team2"] || 0,
                yellow_cards_team1: +d["yellow cards team1"] || 0,
                yellow_cards_team2: +d["yellow cards team2"] || 0,
                red_cards_team1: +d["red cards team1"] || 0,
                red_cards_team2: +d["red cards team2"] || 0
            }));

            filteredData = [...allData];
            createVisualization();
            createLegend();
            setupEventListeners();

        });

        function createVisualization() {
            // Nettoyer le SVG
            svg.selectAll("*").remove();

            // √âchelles
            const xScale = d3.scaleLinear()
                .domain(d3.extent(filteredData, d => d[currentXAxis]))
                .range([0, width])
                .nice();

            const yScale = d3.scaleLinear()
                .domain(d3.extent(filteredData, d => d[currentYAxis]))
                .range([height, 0])
                .nice();

            // Axes
            const xAxis = d3.axisBottom(xScale);
            const yAxis = d3.axisLeft(yScale);

            svg.append("g")
                .attr("class", "axis")
                .attr("transform", `translate(0,${height})`)
                .call(xAxis);

            svg.append("g")
                .attr("class", "axis")
                .call(yAxis);

            // Labels des axes
            svg.append("text")
                .attr("transform", `translate(${width/2},${height + 40})`)
                .style("text-anchor", "middle")
                .style("font-size", "12px")
                .text(getAxisLabel(currentXAxis));

            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .style("font-size", "12px")
                .text(getAxisLabel(currentYAxis));

            // Points
            svg.selectAll(".dot")
                .data(filteredData)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("cx", d => xScale(d[currentXAxis]))
                .attr("cy", d => yScale(d[currentYAxis]))
                .attr("r", 5)
                .style("fill", d => colorScale(d.category))
                .style("opacity", 0.7)
                .on("mouseover", function(event, d) {
                    showTooltip(event, d);
                })
                .on("mouseout", function() {
                    hideTooltip();
                })
                .on("click", function(event, d) {
                    showMatchDetails(d);
                    highlightPoint(this);
                });
        }

        function createLegend() {
            const legend = d3.select("#legend");
            legend.selectAll("*").remove();

            const categories = [...new Set(allData.map(d => d.category))];
            
            const legendItems = legend.selectAll(".legend-item")
                .data(categories)
                .enter().append("div")
                .attr("class", "legend-item");

            legendItems.append("span")
                .attr("class", "legend-color")
                .style("background-color", d => colorScale(d));

            legendItems.append("span")
                .text(d => d);
        }

        function showTooltip(event, d) {
            tooltip.transition().duration(200).style("opacity", .9);
            tooltip.html(`
                <strong>${d.team1} vs ${d.team2}</strong><br/>
                ${d.category}<br/>
                ${d.date.toLocaleDateString('fr-FR')}<br/>
                X: ${d[currentXAxis]}<br/>
                Y: ${d[currentYAxis]}
            `)
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY - 28) + "px");
        }

        function hideTooltip() {
            tooltip.transition().duration(500).style("opacity", 0);
        }

        function showMatchDetails(match) {
            const detailsDiv = d3.select("#match-details");
            
            detailsDiv.html(`
                <div class="match-info">
                    <h3>${match.team1} vs ${match.team2}</h3>
                    <div class="stat-row">
                        <span class="stat-label">Score:</span>
                        <span>${match.goals_team1} - ${match.goals_team2}</span>
                    </div>
                    
                    <div class="stat-row">
                        <span class="stat-label">Phase:</span>
                        <span>${match.category}</span>
                    </div>
                    <div class="stat-row">
                        <span class="stat-label">Date:</span>
                        <span>${match.date.toLocaleDateString('fr-FR')}</span>
                    </div>
                </div>

                <h4>Statistiques D√©taill√©es</h4>
                <div class="stat-row">
                    <span class="stat-label">Possession:</span>
                    <span>${match.possession_team1}% - ${match.possession_team2}%</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Possession en duel:</span>
                    <span>${match.possession_in_contest}%</span>
                </div> 
                <div class="stat-row">
                    <span class="stat-label">Tentatives:</span>
                    <span>${match.attempts_team1} - ${match.attempts_team2}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Tirs cadr√©s:</span>
                    <span>${match.on_target_team1} - ${match.on_target_team2}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Passes totales:</span>
                    <span>${match.passes_team1} - ${match.passes_team2}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Passes r√©ussies:</span>
                    <span>${match.passes_completed_team1} - ${match.passes_completed_team2}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Cartons jaunes:</span>
                    <span>${match.yellow_cards_team1} - ${match.yellow_cards_team2}</span>
                </div>
                <div class="stat-row">
                    <span class="stat-label">Cartons rouges:</span>
                    <span>${match.red_cards_team1} - ${match.red_cards_team2}</span>
                </div>
            `);
        }

        function highlightPoint(element) {
            svg.selectAll(".dot").classed("highlight", false);
            d3.select(element).classed("highlight", true);
        }

        function getAxisLabel(axis) {
            const labels = {
                'possession_team1': 'Possession √âquipe 1 (%)',
                'goals_team1': 'Buts √âquipe 1',
                'attempts_team1': 'Tentatives √âquipe 1',
                'on_target_team1': 'Tirs Cadr√©s √âquipe 1',
                'passes_completed_team1': 'Passes Compl√©t√©es √âquipe 1',
                'yellow_cards_team1': 'Cartons Jaunes √âquipe 1'
            };
            return labels[axis] || axis;
        }

        function setupEventListeners() {
            // Changement d'axes
            d3.select("#x-axis").on("change", function() {
                currentXAxis = this.value;
                createVisualization();
            });

            d3.select("#y-axis").on("change", function() {
                currentYAxis = this.value;
                createVisualization();
            });

            // Filtre par phase
            d3.select("#phase-filter").on("change", function() {
                const selectedPhase = this.value;
                if (selectedPhase === "all") {
                    filteredData = [...allData];
                } else {
                    filteredData = allData.filter(d => d.category === selectedPhase);
                }
                createVisualization();
            });

            // Reset
            d3.select("#reset-btn").on("click", function() {
                filteredData = [...allData];
                d3.select("#x-axis").property("value", "possession_team1");
                d3.select("#y-axis").property("value", "goals_team1");
                d3.select("#phase-filter").property("value", "all");
                currentXAxis = "possession_team1";
                currentYAxis = "goals_team1";
                createVisualization();
                d3.select("#match-details").html(`
                    <p style="color: #7f8c8d; font-style: italic;">
                        Cliquez sur un point pour voir les d√©tails du match
                    </p>
                `);
            });
        }
    </script>
</body>
</html>